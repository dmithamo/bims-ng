<div class="flex flex-col items-center w-full">
  <form
    (submit)="createPassword()"
    [formGroup]="newPasswordForm"
    class="shadow flex flex-col gap-y-10 px-10 py-14 rounded w-[400px] bg-white border border-slate-300">
    <app-page-header
      [hideBackButton]="true"
      pageTitle="Create a new password" />

    <label class="relative block" for="password">
      <span class="font-bold">Password</span>
      <input
        [type]="showPassword() ? 'text' : 'password'"
        class="w-full mt-1 p-3 pl-10 rounded bg-slate-50 border border-slate-300 focus:bg-white focus:border focus:border-black focus:outline-none disabled:bg-slate-50 invalid:border-red-500 invalid:text-red-500"
        formControlName="password"
        id="password"
        placeholder="Enter a strong password" />
      <app-svg-icon
        iconClass="absolute left-0 ml-3 top-6 mt-4 text-gray-400"
        iconName="lock-closed" />

      <app-svg-icon
        (click)="toggleShowPassword()"
        [iconName]="togglePasswordIcon()"
        iconClass="absolute right-0 mr-3 top-6 mt-4 text-gray-400 hover:text-primary cursor-pointer" />

      @if (hasFieldError('password')) {
        @if (password.errors?.['required']) {
          <div class="flex items-center gap-2 text-red-500 mt-2">
            <app-svg-icon iconName="exclamation-circle" />
            <span>Please enter your password</span>
          </div>
        }

        @if (password.errors?.['pattern']) {
          <div class="flex items-center gap-2 text-red-500 mt-2">
            <app-svg-icon iconName="exclamation-circle" />
            <span>
              Password must contain at least 6 characters, including at least 1
              uppercase letter, 1 lowercase letter, and 1 number
            </span>
          </div>
        }
      }
    </label>

    <label class="relative block" for="repeatPassword">
      <span class="font-bold">Repeat password</span>
      <input
        [type]="showPassword() ? 'text' : 'password'"
        class="w-full mt-1 p-3 pl-10 rounded bg-slate-50 border border-slate-300 focus:bg-white focus:border focus:border-black focus:outline-none disabled:bg-slate-50 invalid:border-red-500 invalid:text-red-500"
        formControlName="repeatPassword"
        id="repeatPassword"
        placeholder="Retype your strong password" />
      <app-svg-icon
        iconClass="absolute left-0 ml-3 top-6 mt-4 text-gray-400"
        iconName="lock-closed" />

      <app-svg-icon
        (click)="toggleShowPassword()"
        [iconName]="togglePasswordIcon()"
        iconClass="absolute right-0 mr-3 top-6 mt-4 text-gray-400 hover:text-primary cursor-pointer" />

      @if (hasFieldError('repeatPassword')) {
        @if (repeatPassword.errors?.['required']) {
          <div class="flex items-center gap-2 text-red-500 mt-2">
            <app-svg-icon iconName="exclamation-circle" />
            <span>Please retype your password</span>
          </div>
        }
      }
    </label>

    @if (
      newPasswordForm.touched && newPasswordForm.errors?.['passwordsDoNotMatch']
    ) {
      <div class="flex items-center gap-2 text-red-500 mt-2">
        <app-svg-icon iconName="exclamation-circle" />
        <span>Passwords do not match</span>
      </div>
    }

    @if (createPasswordError()) {
      <div class="flex items-center gap-2 text-red-500 mt-2">
        <app-svg-icon iconName="exclamation-circle" />
        <span> {{ createPasswordError() }}</span>
      </div>
    }

    <button
      [disabled]="newPasswordForm.touched && newPasswordForm.invalid"
      class="mt-8 bg-accent rounded text-white text-2xl py-3 px-16 flex items-center justify-center gap-x-4 disabled:bg-slate-300 disabled:cursor-not-allowed"
      type="submit">
      <app-svg-icon iconName="send" />
      <span>Create</span>
    </button>

    <a
      [routerLink]="['/', APP_ROUTE.auth, APP_ROUTE.login]"
      class="text-secondary-100 underline underline-offset-4"
      >Sign in instead</a
    >
  </form>
</div>
